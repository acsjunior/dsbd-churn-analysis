---
title: "Untitled"
output:
  bookdown::pdf_document2:
    template: template.tex
bibliography: referencias.bib
csl: abnt.csl
lang: pt-BR
header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable} 
- \usepackage{threeparttablex} 
- \usepackage[normalem]{ulem} 
- \usepackage{makecell}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(knitr.table.format = "latex")

TABLE_FONT_SIZE <- 10

library(kableExtra)
```

# Introdução

A importância do relacionamento de longo prazo entre cliente e empresa é um assunto vastamente discutido na literatura. Segundo Ganesh, Arnold e Reynolds [-@Ganesh2000], devido aos efeitos de aprendizado e à redução dos custos de manutenção, atender um cliente se torna menos dispendioso a cada ano adicional de relacionamento. Para Hennig-Thurau [-@HennigThurau2004], devido ao aumento dos custos para atração de novos clientes em um mercado competitivo e à potencial redução dos custos associados aos relacionamentos de longo prazo, a retenção de clientes se torna essencial para a sobrevivência e o sucesso econômico das empresas do setor de serviços. De acordo com Gallo [-@Gallo2014], dependendo do estudo e do segmento no qual a empresa está inserida, o custo para adquirir um novo cliente pode ser de cinco a vinte e cinco vezes superior ao da manutenção de um cliente já existente.
	O desenvolvimento de estratégias para retenção de clientes se tornou uma prática comum entre empresas de diversos segmentos, e em consequência, antever o abandono de clientes passou a ser um anseio constante. Em um momento de concentração generalizada de esforços na direção da orientação a dados, os modelos preditivos para detecção de abandono de clientes, predominantemente utilizados por grandes companhias no setor de telecomunicações, se tornaram ferramentas populares nas empresas, independentemente da magnitude e da área de atuação.
	A literatura comprova que a modelagem preditiva de abandono de clientes, também conhecida como modelagem preditiva de churn, é um tema bastante explorado e que possibilita inúmeras maneiras de desfecho: Botelho e Tostes [-@Botelho2010] ajustaram um modelo de regressão logística para predizer a probabilidade de churn em uma grande empresa de varejo; Vafeiadis et al. [-@Vafeiadis2015] tiveram sucesso, entre os métodos comparados, na classificação de churn através do SVM (kernel polinomial) com AdaBoost em uma empresa de telecomunicações; Com base nos dados de avaliações online de clientes, Kumar e Yadav [-@Kumar2020] propuseram um modelo preditivo de churn baseado em regras através de redes neurais artificiais e teoria dos conjuntos aproximados.
	Com base nos dados de uma startup brasileira que tem como principal produto uma plataforma digital para conectar vendedores de diversos segmentos aos grandes marketplaces, a proposta deste artigo é apresentar um modelo preditivo que possibilite não só a classificação de vendedores propensos a abandonar a empresa, mas que também permita a interpretação dos motivos que possivelmente estejam impactando a predição. Diante da variedade de técnicas disponíveis e das particularidades de cada modelo de negócio, a escolha do algoritmo adequado se torna uma etapa crucial do processo de modelagem. Tendo como referência a abordagem de Silva Júnior, Almeida e Santos [-@Junior2020], que utilizaram uma modelagem híbrida multicritério considerando múltiplos decisores para a escolha de um modelo preditivo de churn, o algoritmo escolhido para desenvolver o classificador proposto foi a regressão logística.

# Materiais e métodos

## Estruturação do conjunto de dados

Os dados utilizados neste trabalho referem-se a clientes de uma startup paranaense, anonimizados e com variáveis variáveis quantitativas padronizadas com média 0 e desvio padrão 1. Considerando que estes clientes contrataram uma plataforma digital que possibilita a venda de produtos nos principais marketplaces, neste trabalho eles serão chamados de vendedores. Devido às características da arquitetura do banco de dados e às particularidades do negócio da companhia, houve a necessidade de realizar um longo processo de data wrangling. De acordo com Kandel et al. [-@Kandel2011], este processo inicia-se por um diagnóstico preliminar dos dados, ou seja, se estão no formato adequado, se respondem as perguntas que motivaram a análise e o que é necessário para colocá-los no formato ideal. Em seguida avalia-se a ocorrência de dados faltantes, valores inconsistentes e duplicatas e, por fim, realiza-se um processo de limpeza e transformação, de modo a se obter um conjunto de dados adequado para o estudo.

### Definição da resposta e covariáveis de desempenho

Inicialmente foram definidos como churn = 1 os vendedores que estiveram inativos por 30 dias corridos desde a data da última atividade e permaneceram no mesmo estado definitivamente, considerando como atividade o acesso à plataforma digital ou a ocorrência de uma venda online. Em seguida, em função da data de corte estabelecida conforme a Tabela \@ref(tab:dataDeCorte), foram mantidos no conjunto de dados somente os vendedores com pelo menos 90 dias de histórico.

```{r dataDeCorte, echo=FALSE}
tabela <- data.frame(Vendedor = c("Definido como churn", "Em atividade normal"),
                  Data_de_corte = c("Última atividade", "Realização da análise"))

names(tabela)[2] <- "Data de corte"

kable(tabela, booktabs = T, caption = "Definição da data de corte") %>%
  kable_styling(font_size = TABLE_FONT_SIZE)
```

O período de 90 dias, finalizado na data de corte, foi dividido igualmente em dois quadrantes, nomeados $Q1$ e $Q2$, onde foram calculadas métricas como faturamento, ticket médio, quantidade de produtos publicados, quantidade de pedidos em cancelados, número de dias com pelo menos 1 venda e etc., em cada um dos quadrantes. Em seguida, através da Equação \@ref(eq:desempenho), foi calculado desempenho do vendedor em função de diversas métricas, onde $V1$ e $V2$ são os valores calculados em $Q1$ e $Q2$.

\begin{equation}
Desempenho = \dfrac{V2}{V1+V2} (\#eq:desempenho)
\end{equation}

As métricas desempenho, data à natureza da equação de origem, possuem o comportamento explicado pela Tabela \@ref(tab:metricas).

```{r metricas, echo=FALSE}
tabela <- data.frame(Valor = c("0,5", "> 0,5", "< 0,5"),
                     Desempenho= c("Mantido", "Aumentado", "Reduzido"))

kable(tabela, booktabs = T, caption = "Interpretação das métricas de desempenho") %>%
  kable_styling(font_size = TABLE_FONT_SIZE)
```

Ao término desta etapa foi obtido um conjunto de dados composto pela variável resposta (churn) e, como covariáveis, 10 métricas de desempenho, onde cada observação representa um vendedor.

### Adição de outras covariáveis

Foram adicionadas outras covariáveis como tipo de plano contratado, estágio, região de origem, faturamento total, e etc., resultando em um conjunto de dados com 26 covariáveis.

### Criação de covariáveis binárias

De acordo com Fávero e Belfiore [-@Favero2017], dada a necessidade de analisar o comportamento da variável resposta em função de uma covariável qualitativa com $n$ categorias, deve-se criar $n-1$ covariáveis binárias (dummies), que assumem valores iguais a 0 ou 1, ficando por conta do pesquisador decidir qual das categorias será a referência (dummy = 0). Portanto, as covariáveis estágio, foram transformadas em binárias, resultando em um conjunto de dados composto por 35 variáveis e 10.975 observações, representado através da tabela 3.

```{r dicionario, echo=FALSE}
df <- read.csv("../../Data/anonymous_train.csv")

df_orig <- read.csv("../../Data/df_train.csv")

tipos <- as.data.frame(sapply(df, class))
tipos <- tipos[[1]]
tipos <- ifelse(tipos == "numeric", "decimal", ifelse(tipos == "integer", "binária", tipos))
descr <- c("Churn (y=1)",
           
           "Fluxo de caixa",
           "Quantidade de produtos no portfólio",
           "Quantidade de produtos cadastrados",
           "Quantidade de marcas cadastradas",
           "Quantidade de categorias cadastradas",
           "Necessita de dias adicionais para postagem (x6=1)",
           "Preço médio dos produtos publicados",
           "Quantidade de produtos publicados",
           "Quantidade total de pedidos",
           "Faturamento total",
           
           "Dias desde a contratação até a primeira venda",
           "Dias desde a contratação até estar pronto para operar",
           "Desempenho da quantidade de pedidos",
           "Dias com pelo menos uma venda efetuada",
           "Desempenho da quantidade de dias com pelo menos uma venda efetuada",
           
           "Desempenho da taxa de pedidos cancelados ou suspensos",
           "Desempenho da taxa de pedidos enviados com atraso",
           "Desempenho da média de dias de pedidos enviados com atraso",
           "Desempenho da média de dias de pedidos entregues com atraso",
           "Desempenho do faturamento",
           "Desempenho da quantidade de produtos cadastrados",
           "Desempenho da quantidade de categorias cadastradas",
           
           "Desempenho do ticket médio",
           "Desempenho da razão dos preços do frete e do pedido",
           "Estágio atual: B (x24 = 1)",
           "Estágio atual: I (x25 = 1)",
           "Estágio atual: R (x26 = 1)",
           "Tipo de plano contratado: L (x27 = 1)",
           "Tipo de plano contratado: M (x28 = 1)",
           "Tipo de plano contratado: S (x29 = 1)",
           "Região de origem: Nordeste (x30 = 1)",
           "Região de origem: Norte (x31 = 1)",
           "Região de origem: Sudeste (x32 = 1)",
           "Região de origem: Sul (x34 = 1)")
  
  
  
  
dic <- data.frame(Variável = names(df),
                  Nome = names(df_orig)[-1],
                  Tipo = tipos,
                  Descrição = descr)
```


# Referências

